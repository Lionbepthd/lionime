<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming - Lionime</title>
    <style>
        /* Gaya Umum */
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #2c3e50;
            --background-color: #1a1a1a;
            --card-background: #2d2d2d;
            --text-color: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Pastikan body setidaknya setinggi viewport */
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            flex: 1; /* Biarkan container utama mengambil ruang yang tersisa */
        }

        a {
            text-decoration: none;
            color: var(--text-color);
        }

        a:hover {
            color: var(--primary-color);
        }

        .hidden {
            display: none;
        }

        /* Header */
        header {
            background-color: var(--secondary-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav ul li a {
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav ul li a:hover,
        nav ul li a.active {
            color: var(--primary-color);
        }

        /* Main Content */
        main {
            padding: 2rem 0;
            flex: 1; /* Biarkan main mengambil ruang yang tersisa */
        }

        h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        /* Video Player */
        #video-player-container {
            background-color: black;
            width: 100%;
            /* Tinggi proporsional 16:9 */
            aspect-ratio: 16 / 9;
            border-radius: var(--border-radius);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
        }

        #video-player-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Episode Info */
        #episode-info {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 2rem;
        }

        #episode-info h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        /* Stream Servers */
        #stream-servers {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 2rem;
        }

        #stream-servers h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        #stream-servers ul {
            list-style: none;
            padding: 0;
        }

        #stream-servers ul li {
            margin-bottom: 0.5rem;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #stream-servers ul li a {
            color: var(--text-secondary);
            text-decoration: underline;
            transition: color 0.3s ease;
            display: block; /* Jadikan link sebagai block agar lebih mudah diklik di mobile */
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #stream-servers ul li a:hover {
            color: var(--primary-color);
        }

        /* Download Links */
        #download-links {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 2rem;
        }

        #download-links h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        #download-links ul {
            list-style: none;
            padding: 0;
        }

        #download-links ul li {
            margin-bottom: 0.5rem;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #download-links ul li a {
            color: var(--text-secondary);
            text-decoration: underline;
            transition: color 0.3s ease;
            display: block; /* Jadikan link sebagai block agar lebih mudah diklik di mobile */
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #download-links ul li a:hover {
            color: var(--primary-color);
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            padding: 1.5rem 0;
            text-align: center;
            margin-top: auto; /* Dorong footer ke bawah */
        }

        /* Media Queries untuk Responsif */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            nav ul {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            main {
                padding: 1rem 0; /* Kurangi padding di mobile */
            }

            h2 {
                font-size: 1.3rem; /* Ukuran font judul lebih kecil */
            }

            #video-player-container {
                /* Tinggi proporsional 16:9 tetap berlaku, tetapi ukuran absolut bisa berkurang */
                /* aspect-ratio: 16 / 9; -- Sudah ditetapkan di atas */
            }

            #episode-info h1 {
                font-size: 1.2rem; /* Ukuran font lebih kecil di mobile */
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1 class="logo">Lionime</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Kembali ke Daftar</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <div id="video-player-container">
            <!-- Player video akan dimuat di sini -->
        </div>

        <div id="episode-info">
            <!-- Info episode akan dimuat di sini -->
        </div>

        <div id="stream-servers">
            <h3>Server Streaming</h3>
            <ul id="stream-servers-list">
                <!-- Link server akan dimuat di sini -->
            </ul>
        </div>

        <div id="download-links">
            <h3>Link Download</h3>
            <ul id="download-links-list">
                <!-- Link download akan dimuat di sini -->
            </ul>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Lionime. Semua hak dilindungi.</p>
    </footer>

    <script>
        const API_BASE = 'https://www.sankavollerei.com/anime';

        // Fungsi untuk mendapatkan parameter URL
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Fungsi untuk memanggil API
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data from API:', error);
                return null;
            }
        }

        // Fungsi untuk menampilkan episode (menggunakan API Animasu)
        async function showEpisode() {
            const episodeSlug = getUrlParameter('episode');
            const animeTitle = getUrlParameter('title'); // Bisa digunakan untuk judul halaman atau info

            console.log("Mencoba memuat episode dari Animasu dengan slug:", episodeSlug, "Anime Title:", animeTitle); // Log untuk debugging

            if (!episodeSlug) {
                document.getElementById('video-player-container').innerHTML = '<p>Episode tidak ditemukan (slug kosong).</p>';
                document.getElementById('episode-info').innerHTML = '<h1>Episode Tidak Diketahui</h1>';
                document.getElementById('stream-servers-list').innerHTML = '';
                document.getElementById('download-links-list').innerHTML = '';
                return;
            }

            // Panggil API episode Animasu
            const data = await fetchAPI(`/animasu/episode/${episodeSlug}`);
            console.log("Respons API /animasu/episode/", episodeSlug, ":", data); // Log untuk debugging

            if (!data || !data.data) {
                console.error("Data episode dari Animasu tidak ditemukan atau struktur salah:", data);
                document.getElementById('video-player-container').innerHTML = '<p>Link streaming tidak ditemukan.</p>';
                document.getElementById('episode-info').innerHTML = '<h1>Episode Tidak Diketahui</h1>';
                document.getElementById('stream-servers-list').innerHTML = '';
                document.getElementById('download-links-list').innerHTML = '';
                return;
            }

            const episodeData = data.data;
            const playerContainer = document.getElementById('video-player-container');
            const infoContainer = document.getElementById('episode-info');
            const streamList = document.getElementById('stream-servers-list');
            const downloadList = document.getElementById('download-links-list');

            // --- Info Episode ---
            infoContainer.innerHTML = `<h1>${episodeData.title || 'Judul Episode Tidak Diketahui'}</h1>`;

            // --- Stream Servers List (API Animasu) ---
            streamList.innerHTML = ''; // Kosongkan dulu
            if (episodeData.streams && episodeData.streams.length > 0) {
                episodeData.streams.forEach(stream => {
                    const li = document.createElement('li');
                    // Gunakan stream.name sebagai teks link
                    li.innerHTML = `<a href="${stream.url}" target="_blank">${stream.name}</a>`;
                    streamList.appendChild(li);
                });
            } else {
                streamList.innerHTML = '<li>Tidak ada link streaming yang tersedia.</li>';
            }

            // --- Download Links List (API Animasu) ---
            downloadList.innerHTML = ''; // Kosongkan dulu
            if (episodeData.downloads && episodeData.downloads.length > 0) {
                episodeData.downloads.forEach(download => {
                    const li = document.createElement('li');
                    // Gunakan download.name sebagai teks link
                    li.innerHTML = `<a href="${download.url}" target="_blank">${download.name}</a>`;
                    downloadList.appendChild(li);
                });
            } else {
                downloadList.innerHTML = '<li>Tidak ada link download yang tersedia.</li>';
            }

            // --- Player Video (API Animasu) ---
            // Gunakan server pertama sebagai default player
            if (episodeData.streams && episodeData.streams.length > 0) {
                const firstStreamUrl = episodeData.streams[0].url;
                playerContainer.innerHTML = `<iframe src="${firstStreamUrl}" frameborder="0" allowfullscreen></iframe>`;
            } else {
                playerContainer.innerHTML = '<p>Tidak ada link streaming utama yang tersedia.</p>';
            }
        }

        // Muat episode saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            showEpisode();
        });
    </script>
</body>
</html>
