<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming - Lionime</title>
    <style>
        /* Gaya Umum */
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #2c3e50;
            --background-color: #1a1a1a;
            --card-background: #2d2d2d;
            --text-color: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Pastikan body setidaknya setinggi viewport */
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            flex: 1; /* Biarkan container utama mengambil ruang yang tersisa */
        }

        a {
            text-decoration: none;
            color: var(--text-color);
        }

        a:hover {
            color: var(--primary-color);
        }

        .hidden {
            display: none;
        }

        /* Header */
        header {
            background-color: var(--secondary-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav ul li a {
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav ul li a.active {
            color: var(--primary-color);
        }

        /* Main Content */
        main {
            padding: 2rem 0;
            display: flex;
            flex-direction: column; /* Susun elemen secara vertikal */
            gap: 2rem; /* Jarak antar elemen */
        }

        h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        /* Video Player */
        #video-player-container {
            background-color: black;
            width: 100%; /* Pastikan lebar penuh */
            /* Tinggi proporsional 16:9 */
            aspect-ratio: 16 / 9;
            border-radius: var(--border-radius);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
        }

        #video-player-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Episode Info */
        #episode-info {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #episode-info h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        /* Episode List */
        #episode-list {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-height: 300px; /* Batasi tinggi */
            overflow-y: auto; /* Tambahkan scroll jika isi terlalu panjang */
        }

        #episode-list h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #episode-list ul {
            list-style: none;
            padding: 0;
            margin: 0; /* Hapus margin default */
        }

        #episode-list ul li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #3c3c3c;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #episode-list ul li:last-child {
            border-bottom: none;
        }

        #episode-list ul li a {
            color: var(--text-secondary);
            transition: color 0.3s ease;
            display: block; /* Jadikan link sebagai block agar lebih mudah diklik di mobile */
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #episode-list ul li a:hover {
            color: var(--primary-color);
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            padding: 1.5rem 0;
            text-align: center;
            margin-top: auto; /* Dorong footer ke bawah */
        }

        /* Media Queries untuk Responsif */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                gap: 1rem;
                text-align: center; /* Pusatkan teks di mobile */
            }

            nav ul {
                gap: 1rem;
                flex-wrap: wrap; /* Bungkus link jika terlalu banyak */
                justify-content: center; /* Pusatkan link nav */
            }

            main {
                padding: 1rem 0; /* Kurangi padding di mobile */
            }

            #video-player-container {
                /* Tinggi proporsional 16:9 tetap berlaku, tetapi ukuran absolut bisa berkurang */
                /* aspect-ratio: 16 / 9; -- Sudah ditetapkan di atas */
            }

            #episode-info h1 {
                font-size: 1.2rem; /* Ukuran font lebih kecil di mobile */
            }

            #episode-list {
                max-height: 200px; /* Kurangi tinggi maksimum di mobile */
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1 class="logo">Lionime</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Kembali ke Daftar</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <div id="video-player-container">
            <!-- Player video akan dimuat di sini -->
        </div>

        <div id="episode-info">
            <!-- Info episode akan dimuat di sini -->
        </div>

        <div id="episode-list">
            <h3>Daftar Episode <span id="anime-title-placeholder">untuk Anime</span></h3>
            <ul id="episode-list-ul">
                <!-- Daftar episode akan dimuat di sini -->
            </ul>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Lionime. Semua hak dilindungi.</p>
    </footer>

    <script>
        const API_BASE = 'https://www.sankavollerei.com/anime';

        // Fungsi untuk mendapatkan parameter URL
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Fungsi untuk memanggil API
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data from API:', error);
                return null;
            }
        }

        // Fungsi untuk menampilkan episode dan daftar episode terkait
        async function loadEpisode() {
            const episodeSlug = getUrlParameter('episode');
            const animeTitle = getUrlParameter('title');
            const animeId = getUrlParameter('animeId');

            console.log("Mencoba memuat episode:", episodeSlug, "Anime ID:", animeId, "Anime Title:", animeTitle); // Log untuk debugging

            if (!episodeSlug) {
                document.getElementById('video-player-container').innerHTML = '<p>Episode tidak ditemukan (slug kosong).</p>';
                document.getElementById('episode-info').innerHTML = '<h1>Episode Tidak Diketahui</h1>';
                document.getElementById('episode-list-ul').innerHTML = '<p>Parameter episode tidak valid.</p>';
                return;
            }

            // Update judul placeholder daftar episode
            if (animeTitle) {
                document.getElementById('anime-title-placeholder').textContent = `untuk ${decodeURIComponent(animeTitle)}`;
            }

            const data = await fetchAPI(`/episode/${episodeSlug}`);
            if (!data || !data.data) {
                console.error("Data episode tidak ditemukan atau struktur salah:", data);
                document.getElementById('video-player-container').innerHTML = '<p>Link streaming tidak ditemukan.</p>';
                document.getElementById('episode-info').innerHTML = '<h1>Episode Tidak Diketahui</h1>';
                document.getElementById('episode-list-ul').innerHTML = '<p>Data episode tidak ditemukan.</p>';
                return;
            }

            const episodeData = data.data;
            const playerContainer = document.getElementById('video-player-container');
            const infoContainer = document.getElementById('episode-info');

            // --- Info Episode ---
            infoContainer.innerHTML = `<h1>${episodeData.episode || 'Judul Episode Tidak Diketahui'}</h1>`;

            // --- Player Video ---
            if (episodeData.stream_url) {
                playerContainer.innerHTML = `<iframe src="${episodeData.stream_url}" frameborder="0" allowfullscreen></iframe>`;
            } else {
                playerContainer.innerHTML = '<p>Link streaming utama tidak ditemukan atau tidak bisa dimuat di sini.</p>';
            }

            // --- Daftar Episode Terkait ---
            if (animeId) {
                console.log("Mencari detail anime untuk ID:", animeId); // Log untuk debugging
                const animeDetailData = await fetchAPI(`/anime/${animeId}`);
                console.log("Data detail anime:", animeDetailData); // Log untuk debugging

                if (animeDetailData && animeDetailData.data && animeDetailData.data.episode_lists && Array.isArray(animeDetailData.data.episode_lists)) {
                    const episodeListUl = document.getElementById('episode-list-ul');
                    const sortedEpisodes = [...animeDetailData.data.episode_lists].sort((a, b) => a.episode_number - b.episode_number);
                    episodeListUl.innerHTML = ''; // Kosongkan dulu

                    sortedEpisodes.forEach(ep => {
                        const li = document.createElement('li');
                        const isActive = ep.slug === episodeSlug ? 'style="color: var(--primary-color); font-weight: bold;"' : '';
                        // Ganti link untuk reload halaman stream dengan episode baru
                        li.innerHTML = `<a href="stream.html?episode=${ep.slug}&title=${encodeURIComponent(animeDetailData.data.title)}&animeId=${animeId}" ${isActive}>${ep.episode_number}. ${ep.episode}</a>`;
                        episodeListUl.appendChild(li);
                    });
                    console.log("Daftar episode berhasil dimuat."); // Log untuk debugging
                } else {
                    document.getElementById('episode-list-ul').innerHTML = '<p>Daftar episode tidak ditemukan (struktur data salah atau tidak ada). Error API?</p>';
                    console.warn("Struktur data episode_lists tidak ditemukan atau bukan array:", animeDetailData);
                }
            } else {
                document.getElementById('episode-list-ul').innerHTML = '<p>Daftar episode tidak ditemukan (ID Anime tidak diberikan dari halaman sebelumnya).</p>';
                console.warn("animeId tidak ditemukan di URL.");
            }
        }

        // Muat episode saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            loadEpisode();
        });
    </script>
</body>
</html>
