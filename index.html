<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lionime - Nonton Anime & Donghua Sub Indo Gratis</title>
    <style>
        /* Gaya Umum */
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #2c3e50;
            --background-color: #1a1a1a;
            --card-background: #2d2d2d;
            --text-color: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Pastikan body setidaknya setinggi viewport */
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            flex: 1; /* Biarkan container utama mengambil ruang yang tersisa */
        }

        a {
            text-decoration: none;
            color: var(--text-color);
        }

        a:hover {
            color: var(--primary-color);
        }

        .hidden {
            display: none;
        }

        /* Header */
        header {
            background-color: var(--secondary-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1rem; /* Kurangi gap antar link */
            flex-wrap: wrap; /* Bungkus jika terlalu banyak */
            justify-content: center; /* Pusatkan link */
        }

        nav ul li a {
            font-weight: 500;
            transition: color 0.3s ease;
            padding: 0.5rem 1rem; /* Tambahkan padding untuk area klik yang lebih besar */
            border-radius: var(--border-radius); /* Tambahkan border radius */
        }

        nav ul li a:hover,
        nav ul li a.active {
            background-color: rgba(231, 76, 60, 0.2); /* Warna latar saat hover/aktif */
            color: var(--primary-color);
        }

        .search-container {
            display: flex;
            gap: 0.5rem;
            width: 100%; /* Buat search container mengambil lebar penuh di mobile */
            margin-top: 1rem; /* Tambahkan jarak dari nav */
        }

        #search-input, #search-button {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            border: none;
        }

        #search-input {
            background-color: #3c3c3c;
            color: var(--text-color);
            flex: 1; /* Buat input mengambil ruang yang tersisa */
        }

        #search-button {
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #search-button:hover {
            background-color: #c0392b;
        }

        /* Main Content */
        main {
            padding: 2rem 0;
            flex: 1; /* Biarkan main mengambil ruang yang tersisa */
        }

        section {
            margin-bottom: 2rem;
        }

        h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        /* Anime Grid */
        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); /* Lebar minimum card disesuaikan */
            gap: 1rem; /* Kurangi gap sedikit */
        }

        .anime-card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex; /* Gunakan flex untuk mengatur gambar dan info */
            flex-direction: column; /* Susun gambar dan info secara vertikal */
        }

        .anime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .anime-card img {
            width: 100%;
            height: 190px; /* Atur tinggi gambar tetap */
            object-fit: cover;
            display: block;
        }

        .anime-card .info {
            padding: 0.8rem; /* Kurangi padding */
            flex: 1; /* Info mengambil ruang yang tersisa */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Info teks di atas, status di bawah */
        }

        .anime-card .info h3 {
            font-size: 0.9rem; /* Ukuran font lebih kecil */
            margin-bottom: 0.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .anime-card .info p {
            font-size: 0.75rem; /* Ukuran font lebih kecil */
            color: var(--text-secondary);
            margin: 0; /* Hapus margin default */
        }

        /* Detail Content */
        #detail-content {
            display: flex;
            flex-direction: column; /* Susun detail dan episode list secara vertikal */
            gap: 2rem;
        }

        #anime-detail {
            display: flex;
            flex-direction: column; /* Di mobile, gambar dan teks disusun vertikal */
            gap: 1.5rem;
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #anime-detail img {
            width: 100%; /* Gambar mengambil lebar penuh */
            height: 300px; /* Atur tinggi tetap */
            object-fit: cover;
            border-radius: var(--border-radius);
            align-self: center; /* Pusatkan gambar */
        }

        #anime-detail .text {
            flex: 1;
        }

        #anime-detail .text h1 {
            font-size: 1.5rem; /* Ukuran font lebih kecil */
            margin-bottom: 1rem;
            color: var(--primary-color);
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #anime-detail .text p {
            margin-bottom: 0.5rem;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #recommendations-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #3c3c3c;
        }

        #recommendations-section h3 {
            margin-bottom: 1rem;
        }

        #episode-list {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            /* max-height akan diatur oleh JavaScript saat toggle */
        }

        #episode-list h3 {
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #episode-list h3 button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
        }

        #episode-list h3 button:hover {
            color: var(--primary-color);
        }

        #episode-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 400px; /* Batasi tinggi daftar episode */
            overflow-y: auto; /* Tambahkan scroll jika isi terlalu panjang */
        }

        #episode-list ul li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #3c3c3c;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #episode-list ul li:last-child {
            border-bottom: none;
        }

        #episode-list ul li a {
            color: var(--text-secondary);
            transition: color 0.3s ease;
            display: block; /* Jadikan link sebagai block agar lebih mudah diklik di mobile */
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #episode-list ul li a:hover {
            color: var(--primary-color);
        }

        /* Schedule */
        .schedule-day {
            margin-bottom: 2rem;
        }

        .schedule-day h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        /* All Anime */
        .all-anime-letter {
            margin-bottom: 2rem;
        }

        .all-anime-letter h3 {
            color: var(--primary-color);
            display: inline-block;
            width: 2rem;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .all-anime-list-ul {
            list-style: none;
            padding-left: 3rem;
        }

        .all-anime-list-ul li {
            margin-bottom: 0.25rem;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        .all-anime-list-ul li a {
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .all-anime-list-ul li a:hover {
            color: var(--primary-color);
        }

        /* Batch Links */
        #batch-links-container {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #3c3c3c;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        #batch-links-container h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .batch-format {
            margin-bottom: 1rem;
        }

        .batch-quality {
            margin-bottom: 0.5rem;
        }

        .batch-quality p {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .batch-quality ul {
            list-style: none;
            padding-left: 1rem;
        }

        .batch-quality ul li {
            margin-bottom: 0.25rem;
            word-wrap: break-word; /* Pecah teks jika terlalu panjang */
            overflow-wrap: break-word;
        }

        .batch-quality ul li a {
            color: var(--text-secondary);
            text-decoration: underline;
            transition: color 0.3s ease;
        }

        .batch-quality ul li a:hover {
            color: var(--primary-color);
        }

        /* Genre List (Anime) - Ditampilkan sebagai grid di desktop */
        #genre-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        #genre-list a {
            display: block;
            padding: 1rem;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            text-align: center;
            transition: background-color 0.3s ease;
        }
        #genre-list a:hover {
            background-color: #3c3c3c;
        }

        /* Search Result Sections */
        .search-result-section {
            margin-bottom: 2rem; /* Jarak antar bagian hasil */
        }

        .search-result-section h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            padding: 1.5rem 0;
            text-align: center;
            margin-top: auto; /* Dorong footer ke bawah */
        }

        /* Media Queries untuk Responsif */
        @media (min-width: 769px) {
            /* Gaya untuk desktop/laptop */
            header .container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .search-container {
                width: auto; /* Kembalikan lebar otomatis di desktop */
                margin-top: 0; /* Hapus margin */
            }

            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* Lebar card lebih besar di desktop */
            }

            #anime-detail {
                flex-direction: row; /* Di desktop, gambar dan teks disusun horizontal */
                gap: 2rem;
            }

            #anime-detail img {
                width: 250px; /* Lebar tetap di desktop */
                height: 350px; /* Tinggi tetap di desktop */
                align-self: flex-start; /* Gambar tetap di atas */
            }

            #anime-detail .text h1 {
                font-size: 1.8rem; /* Ukuran font lebih besar di desktop */
            }

            /* Atur kembali #genre-list untuk desktop jika diinginkan */
            /* Misalnya, kembali ke grid */
            #genre-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }
            #genre-list a {
                display: block;
                padding: 1rem;
                background-color: var(--card-background);
                border-radius: var(--border-radius);
                margin-bottom: 0; /* Hapus margin di desktop karena grid */
                text-align: center;
                transition: background-color 0.3s ease;
            }
            #genre-list a:last-child {
                margin-bottom: 0;
            }
        }

        @media (max-width: 768px) {
            /* Gaya untuk mobile */
            nav ul {
                gap: 0.5rem; /* Kurangi gap */
                justify-content: center;
            }

            nav ul li a {
                font-size: 0.9rem; /* Ukuran font lebih kecil */
                padding: 0.4rem 0.8rem; /* Padding lebih kecil */
            }

            main {
                padding: 1rem 0; /* Kurangi padding di mobile */
            }

            h2 {
                font-size: 1.3rem; /* Ukuran font judul lebih kecil */
            }

            #episode-list ul {
                max-height: 250px; /* Kurangi tinggi maksimum daftar episode di mobile */
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1 class="logo">Lionime</h1>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-page="home">Home</a></li>
                    <li><a href="#" data-page="ongoing">Ongoing</a></li>
                    <li><a href="#" data-page="completed">Completed</a></li>
                    <li><a href="#" data-page="schedule">Schedule</a></li>
                    <li><a href="#" data-page="genre">Genre</a></li>
                    <li><a href="#" data-page="all-anime">All Anime</a>
                    <!-- Menu navigasi Donghua dihapus -->
                </ul>
            </nav>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Cari anime...">
                <button id="search-button">Cari</button>
            </div>
        </div>
    </header>

    <main class="container">
        <section id="home-content">
            <h2>Anime Terbaru</h2>
            <div id="anime-latest-grid" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>

            <h2>Donghua Terbaru</h2>
            <div id="donghua-latest-grid" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>
        </section>

        <section id="detail-content" class="hidden">
            <div id="anime-detail">
                <!-- Detail anime akan dimuat di sini -->
            </div>
            <div id="episode-list">
                <h3>Daftar Episode <button id="toggle-episode-list">Sembunyikan</button></h3>
                <ul id="episode-list-ul">
                    <!-- Daftar episode akan dimuat di sini -->
                </ul>
            </div>
        </section>

        <section id="search-results" class="hidden">
            <h2>Hasil Pencarian</h2>
            <div id="search-results-list" class="anime-grid">
                <!-- Hasil pencarian akan dimuat di sini -->
            </div>
        </section>

        <section id="ongoing-content" class="hidden">
            <h2>Anime Sedang Tayang</h2>
            <div id="ongoing-anime-list" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>
        </section>

        <section id="completed-content" class="hidden">
            <h2>Anime Tamat</h2>
            <div id="completed-anime-list" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>
        </section>

        <section id="genre-content" class="hidden">
            <h2>Daftar Genre</h2>
            <div id="genre-list">
                <!-- Genre akan dimuat di sini -->
            </div>
        </section>

        <section id="schedule-content" class="hidden">
            <h2>Jadwal Rilis Anime</h2>
            <div id="schedule-list">
                <!-- Jadwal akan dimuat di sini -->
            </div>
        </section>

        <section id="all-anime-content" class="hidden">
            <h2>Semua Anime</h2>
            <div id="all-anime-list">
                <!-- Daftar semua anime akan dimuat di sini -->
            </div>
        </section>

        <!-- Section Donghua dihapus -->

    </main>

    <footer>
        <p>&copy; 2025 Lionime. Semua hak dilindungi.</p>
    </footer>

    <script>
        const API_BASE = 'https://www.sankavollerei.com/anime';

        // Fungsi untuk memanggil API
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data from API:', error);
                return null;
            }
        }

        // Fungsi untuk merender daftar anime atau donghua ke HTML
        function renderAnimeList(animes, containerOrId, isDonghua = false) {
            // Jika containerOrId adalah string, ambil element-nya
            const container = typeof containerOrId === 'string' ? document.getElementById(containerOrId) : containerOrId;
            if (!container || !animes) {
                console.error('Container atau data animes tidak valid');
                return;
            }
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (!animes.length) {
                container.innerHTML = '<p>Tidak ada data yang ditemukan.</p>';
                return;
            }

            animes.forEach(anime => {
                const card = document.createElement('div');
                card.className = 'anime-card';
                // Gunakan properti yang tersedia tergantung datanya (ongoing, complete, search, detail recs)
                let infoText = 'Info Tidak Diketahui';
                if (anime.current_episode) {
                    infoText = anime.current_episode; // Misal: "Total 7 Eps"
                } else if (anime.episode_count) {
                    infoText = `Eps: ${anime.episode_count}`;
                } else if (anime.status) {
                    infoText = anime.status; // Misal: "Completed"
                }
                // Tambahkan release_day jika tersedia dan tidak ada current_episode
                if (anime.release_day && !anime.current_episode) {
                    infoText += ` (${anime.release_day})`;
                } else if (anime.release_day && anime.current_episode) {
                     infoText = `${anime.current_episode} (${anime.release_day})`;
                } else if (anime.last_release_date) {
                     infoText += ` (${anime.last_release_date})`;
                }

                card.innerHTML = `
                    <img src="${anime.poster || 'https://via.placeholder.com/180x250?text=No+Image'}" alt="${anime.title}">
                    <div class="info">
                        <h3>${anime.title}</h3>
                        <p>${infoText}</p>
                    </div>
                `;
                // Gunakan fungsi yang sesuai berdasarkan apakah ini Donghua atau bukan
                if (isDonghua) {
                    card.addEventListener('click', () => showDonghuaDetail(anime.slug)); // <-- Pastikan fungsi ini dipanggil
                } else {
                    card.addEventListener('click', () => showAnimeDetail(anime.slug));
                }
                container.appendChild(card);
            });
        }

        // Fungsi untuk menampilkan detail anime
        async function showAnimeDetail(slug) {
            const data = await fetchAPI(`/anime/${slug}`);
            if (!data || !data.data) {
                console.error("Data detail anime tidak ditemukan atau struktur salah:", data);
                document.getElementById('anime-detail').innerHTML = '<p>Detail anime tidak ditemukan.</p>';
                document.getElementById('episode-list-ul').innerHTML = '';
                return;
            }

            const anime = data.data; // Ambil objek anime dari data.data
            const detailContainer = document.getElementById('anime-detail');
            const episodeListUl = document.getElementById('episode-list-ul');

            // Render detail utama anime
            detailContainer.innerHTML = `
                <img src="${anime.poster || 'https://via.placeholder.com/250x350?text=No+Image'}" alt="${anime.title}">
                <div class="text">
                    <h1>${anime.title}</h1>
                    <p><strong>Judul Jepang:</strong> ${anime.japanese_title || 'Tidak Diketahui'}</p>
                    <p><strong>Genre:</strong> ${anime.genres ? anime.genres.map(g => g.name).join(', ') : 'Tidak Diketahui'}</p>
                    <p><strong>Status:</strong> ${anime.status || 'Tidak Diketahui'}</p>
                    <p><strong>Episode:</strong> ${anime.episode_count || 'Tidak Diketahui'}</p>
                    <p><strong>Tipe:</strong> ${anime.type || 'Tidak Diketahui'}</p>
                    <p><strong>Studio:</strong> ${anime.studio || 'Tidak Diketahui'}</p>
                    <p><strong>Rating:</strong> ${anime.rating || 'Tidak Diketahui'}</p>
                    <p><strong>Rilis:</strong> ${anime.release_date || 'Tidak Diketahui'}</p>
                    <p><strong>Durasi:</strong> ${anime.duration || 'Tidak Diketahui'}</p>
                    <p><strong>Sinopsis:</strong> ${anime.synopsis || 'Tidak tersedia.'}</p>
                    <!-- Link batch akan ditambahkan di sini -->
                    <div id="batch-links-container">
                        <!-- Link batch akan dimuat di sini -->
                    </div>
                </div>
            `;

            // --- Tambahkan Link Batch ---
            if (anime.batch && anime.batch.slug) {
                const batchData = await fetchAPI(`/batch/${anime.batch.slug}`);
                if (batchData && batchData.data && batchData.data.downloadUrl) {
                    const batchContainer = document.getElementById('batch-links-container');
                    renderBatchLinks(batchData.data, batchContainer);
                } else {
                    console.warn("Data batch tidak ditemukan atau struktur salah:", batchData);
                    // Jika API batch gagal, tetap tampilkan link lama (otakudesu_url dari batch)
                    document.getElementById('batch-links-container').innerHTML = `<p><a href="${anime.batch.otakudesu_url}" target="_blank">Link Batch (Luaran): ${anime.batch.slug}</a></p>`;
                }
            } else {
                // Jika tidak ada informasi batch di detail, sembunyikan container atau biarkan kosong
                document.getElementById('batch-links-container').style.display = 'none';
            }

            // Tambahkan container untuk rekomendasi
            detailContainer.innerHTML += `
                <div id="recommendations-section" class="recommendations-container">
                    <h3>Anime Rekomendasi</h3>
                    <div id="recommendations-list" class="anime-grid">
                        <!-- Rekomendasi akan dimuat di sini -->
                    </div>
                </div>
            `;

            // Render rekomendasi jika ada
            if (anime.recommendations && anime.recommendations.length > 0) {
                renderAnimeList(anime.recommendations, 'recommendations-list', false); // Pastikan ini adalah daftar anime
            } else {
                document.getElementById('recommendations-list').innerHTML = '<p>Tidak ada rekomendasi.</p>';
            }

            // --- Ambil slug anime yang benar untuk digunakan di link episode ---
            // Kita ambil dari anime.otakudesu_url atau anime.slug (dari data /anime/{slug})
            // Karena anime.slug dari /anime/{slug} bisa jadi URL penuh, kita ambil bagian akhirnya
            const correctAnimeId = anime.otakudesu_url ? anime.otakudesu_url.split('/').pop() : anime.slug.split('/').pop(); // Perbaikan di sini

            // Render daftar episode
            if (anime.episode_lists && anime.episode_lists.length > 0) {
                // Urutkan episode berdasarkan episode_number (opsional, tapi bagus untuk urutan)
                const sortedEpisodes = [...anime.episode_lists].sort((a, b) => a.episode_number - b.episode_number);
                episodeListUl.innerHTML = ''; // Kosongkan dulu

                sortedEpisodes.forEach(ep => {
                    const li = document.createElement('li');
                    // Gunakan episode_number untuk teks link
                    // Ganti onclick untuk membuka halaman stream.html dengan animeId yang benar
                    li.innerHTML = `<a href="stream.html?episode=${ep.slug}&title=${encodeURIComponent(anime.title)}&animeId=${correctAnimeId}" target="_blank">${ep.episode_number}. ${ep.episode}</a>`;
                    episodeListUl.appendChild(li);
                });
            } else {
                episodeListUl.innerHTML = '<p>Daftar episode tidak tersedia.</p>';
            }

            // Tampilkan section detail
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('detail-content').classList.remove('hidden');
            document.getElementById('episode-list').classList.remove('hidden'); // Pastikan episode list ditampilkan saat masuk detail
            document.getElementById('toggle-episode-list').textContent = 'Sembunyikan'; // Reset tombol
        }

        // Fungsi untuk menampilkan detail donghua
        async function showDonghuaDetail(slug) {
            // Panggil API detail Donghua dengan slug yang benar
            const data = await fetchAPI(`/donghua/detail/${slug}`);
            if (!data || !data.data) {
                console.error("Data detail donghua tidak ditemukan atau struktur salah:", data);
                document.getElementById('anime-detail').innerHTML = '<p>Detail donghua tidak ditemukan.</p>';
                document.getElementById('episode-list-ul').innerHTML = '';
                return;
            }

            const donghua = data.data; // Ambil objek donghua dari data.data
            const detailContainer = document.getElementById('anime-detail');
            const episodeListUl = document.getElementById('episode-list-ul');

            // Render detail utama donghua
            detailContainer.innerHTML = `
                <img src="${donghua.poster || 'https://via.placeholder.com/250x350?text=No+Image'}" alt="${donghua.title}">
                <div class="text">
                    <h1>${donghua.title}</h1>
                    <p><strong>Judul Jepang:</strong> ${donghua.japanese_title || 'Tidak Diketahui'}</p>
                    <p><strong>Genre:</strong> ${donghua.genres ? donghua.genres.map(g => g.name).join(', ') : 'Tidak Diketahui'}</p>
                    <p><strong>Status:</strong> ${donghua.status || 'Tidak Diketahui'}</p>
                    <p><strong>Episode:</strong> ${donghua.episode_count || 'Tidak Diketahui'}</p>
                    <p><strong>Tipe:</strong> ${donghua.type || 'Tidak Diketahui'}</p>
                    <p><strong>Studio:</strong> ${donghua.studio || 'Tidak Diketahui'}</p>
                    <p><strong>Rating:</strong> ${donghua.rating || 'Tidak Diketahui'}</p>
                    <p><strong>Rilis:</strong> ${donghua.release_date || 'Tidak Diketahui'}</p>
                    <p><strong>Durasi:</strong> ${donghua.duration || 'Tidak Diketahui'}</p>
                    <p><strong>Sinopsis:</strong> ${donghua.synopsis || 'Tidak tersedia.'}</p>
                    <!-- Link batch mungkin berbeda untuk Donghua, abaikan dulu -->
                    <!-- <div id="batch-links-container">
                        <p>Batch tidak tersedia untuk Donghua saat ini.</p>
                    </div> -->
                </div>
            `;

            // Tambahkan container untuk rekomendasi (jika ada)
            detailContainer.innerHTML += `
                <div id="recommendations-section" class="recommendations-container">
                    <h3>Donghua Rekomendasi</h3>
                    <div id="recommendations-list" class="anime-grid">
                        <!-- Rekomendasi akan dimuat di sini -->
                    </div>
                </div>
            `;

            // Render rekomendasi jika ada (jika API menyediakan)
            if (donghua.recommendations && donghua.recommendations.length > 0) {
                renderAnimeList(donghua.recommendations, 'recommendations-list', true); // Pastikan ini adalah daftar donghua
            } else {
                document.getElementById('recommendations-list').innerHTML = '<p>Tidak ada rekomendasi.</p>';
            }

            // Render daftar episode
            // Periksa episodes_list (untuk Donghua) atau episode_lists (untuk Anime biasa)
            if (donghua.episodes_list && donghua.episodes_list.length > 0) { // Periksa episodes_list untuk Donghua
                // Urutkan episode berdasarkan episode_number (opsional, tapi bagus untuk urutan)
                // Karena Donghua API mungkin tidak menyediakan episode_number secara eksplisit dalam struktur ini,
                // kita bisa mengurutkan berdasarkan slug atau mengasumsikan urutan dalam array sudah benar.
                // Jika episode_number diperlukan, kita perlu ekstrak dari judul episode atau slug.
                // Untuk sementara, kita asumsikan urutan dalam episodes_list sudah benar.
                const sortedEpisodes = [...donghua.episodes_list]; // Salin array

                episodeListUl.innerHTML = ''; // Kosongkan dulu

                sortedEpisodes.forEach(ep => {
                    const li = document.createElement('li');
                    // Ambil nomor episode dari judul episode jika memungkinkan
                    // Contoh: "Little Fairy Yao Episode 40 Tamat Subtitle Indonesia"
                    // Kita bisa mencoba ekstrak "Episode 40" menggunakan regex
                    let episodeNumber = "N/A";
                    const episodeMatch = ep.episode.match(/Episode\s+(\d+)/i);
                    if (episodeMatch) {
                        episodeNumber = episodeMatch[1];
                    } else {
                        // Jika tidak bisa diambil, gunakan slug atau bagian akhir URL
                        // Contoh slug: little-fairy-yao-episode-40-tamat-subtitle-indonesia
                        const slugMatch = ep.slug.match(/episode-(\d+)/i);
                        if (slugMatch) {
                            episodeNumber = slugMatch[1];
                        }
                    }

                    // Gunakan episode_number untuk teks link
                    // Ganti href untuk membuka halaman stream_donghua.html
                    li.innerHTML = `<a href="stream_donghua.html?episode=${ep.slug}&title=${encodeURIComponent(donghua.title)}&animeId=${donghua.slug}" target="_blank">${episodeNumber}. ${ep.episode}</a>`;
                    episodeListUl.appendChild(li);
                });
            } else if (donghua.episode_lists && donghua.episode_lists.length > 0) {
                // Jika episodes_list tidak ditemukan, coba episode_lists (kemungkinan API lama atau konsistensi)
                const sortedEpisodes = [...donghua.episode_lists].sort((a, b) => a.episode_number - b.episode_number);
                episodeListUl.innerHTML = ''; // Kosongkan dulu

                sortedEpisodes.forEach(ep => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="stream_donghua.html?episode=${ep.slug}&title=${encodeURIComponent(donghua.title)}&animeId=${donghua.slug}" target="_blank">${ep.episode_number}. ${ep.episode}</a>`;
                    episodeListUl.appendChild(li);
                });
            } else {
                episodeListUl.innerHTML = '<p>Daftar episode tidak tersedia.</p>';
            }

            // Tampilkan section detail
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('detail-content').classList.remove('hidden');
            document.getElementById('episode-list').classList.remove('hidden'); // Pastikan episode list ditampilkan saat masuk detail
            document.getElementById('toggle-episode-list').textContent = 'Sembunyikan'; // Reset tombol
        }

        // Fungsi untuk menampilkan episode
        async function showEpisode(slug) {
            const data = await fetchAPI(`/episode/${slug}`);
            if (!data || !data.data) {
                console.error("Data episode tidak ditemukan atau struktur salah:", data);
                document.getElementById('video-player-container').innerHTML = '<p>Link streaming tidak ditemukan.</p>';
                document.getElementById('episode-info').innerHTML = '<h1>Episode Tidak Diketahui</h1>';
                return;
            }

            const episodeData = data.data;
            const playerContainer = document.getElementById('video-player-container');
            const infoContainer = document.getElementById('episode-info');

            // --- Info Episode ---
            infoContainer.innerHTML = `<h1>${episodeData.episode || 'Judul Episode Tidak Diketahui'}</h1>`;

            // --- Player Video ---
            // Cek apakah stream_url tersedia
            if (episodeData.stream_url) {
                playerContainer.innerHTML = `<iframe src="${episodeData.stream_url}" frameborder="0" allowfullscreen></iframe>`;
            } else {
                // Jika stream_url tidak ada, dan kita tidak bisa mengandalkan /server/ karena error,
                // maka kita beri tahu pengguna bahwa tidak bisa dimainkan secara langsung di sini.
                playerContainer.innerHTML = '<p>Link streaming utama tidak ditemukan atau tidak bisa dimuat di sini.</p>';
            }

            // Tampilkan section episode
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('episode-content').classList.remove('hidden');
        }

        // Fungsi untuk pencarian (Anime dan Donghua)
        async function searchContent() {
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;

            // Kosongkan container pencarian dulu
            const container = document.getElementById('search-results-list');
            container.innerHTML = '<p>Mencari...</p>';

            // Panggil API untuk Anime dan Donghua secara paralel
            const [animeData, donghuaData] = await Promise.all([
                fetchAPI(`/search/${encodeURIComponent(query)}`),
                fetchAPI(`/donghua/search/${encodeURIComponent(query)}/1`)
            ]);

            let combinedResults = [];
            let hasAnime = false;
            let hasDonghua = false;

            // Proses hasil pencarian Anime
            if (animeData && animeData.data && Array.isArray(animeData.data)) {
                // Tambahkan flag bahwa ini adalah hasil Anime
                const animeResults = animeData.data.map(item => ({...item, isDonghua: false}));
                combinedResults.push(...animeResults);
                hasAnime = true;
            }

            // Proses hasil pencarian Donghua
            if (donghuaData && donghuaData.data && Array.isArray(donghuaData.data)) {
                // Tambahkan flag bahwa ini adalah hasil Donghua
                const donghuaResults = donghuaData.data.map(item => ({...item, isDonghua: true}));
                combinedResults.push(...donghuaResults);
                hasDonghua = true;
            }

            // Tampilkan hasil gabungan
            if (combinedResults.length > 0) {
                // Urutkan jika diinginkan (contoh: berdasarkan title)
                // combinedResults.sort((a, b) => a.title.localeCompare(b.title));

                // Render hasil ke container pencarian
                renderCombinedSearchResults(combinedResults, 'search-results-list');
                let title = `Hasil Pencarian: ${query}`;
                if (hasAnime && hasDonghua) {
                    title = `Hasil Pencarian (Anime & Donghua): ${query}`;
                } else if (hasAnime) {
                    title = `Hasil Pencarian (Anime): ${query}`;
                } else if (hasDonghua) {
                    title = `Hasil Pencarian (Donghua): ${query}`;
                }
                document.getElementById('search-results').querySelector('h2').textContent = title;
            } else {
                container.innerHTML = '<p>Hasil pencarian tidak ditemukan untuk Anime atau Donghua.</p>';
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Pencarian: ${query}`;
            }

            // Tampilkan section hasil pencarian
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('search-results').classList.remove('hidden');
        }

        // Fungsi untuk merender hasil pencarian gabungan (Anime dan Donghua) ke HTML
        function renderCombinedSearchResults(items, containerId) {
            const container = document.getElementById(containerId);
            if (!container || !items) {
                console.error('Container atau data items tidak valid');
                return;
            }
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (!items.length) {
                container.innerHTML = '<p>Tidak ada data yang ditemukan.</p>';
                return;
            }

            // Kelompokkan hasil berdasarkan isDonghua
            const animeItems = items.filter(item => !item.isDonghua);
            const donghuaItems = items.filter(item => item.isDonghua);

            // Tambahkan judul dan grid untuk Anime jika ada
            if (animeItems.length > 0) {
                const animeSection = document.createElement('div');
                animeSection.className = 'search-result-section';
                animeSection.innerHTML = `<h3>Anime</h3>`;
                const animeGrid = document.createElement('div');
                animeGrid.className = 'anime-grid';
                animeSection.appendChild(animeGrid);
                container.appendChild(animeSection);
                renderAnimeList(animeItems, animeGrid, false); // Gunakan renderAnimeList untuk bagian ini
            }

            // Tambahkan judul dan grid untuk Donghua jika ada
            if (donghuaItems.length > 0) {
                const donghuaSection = document.createElement('div');
                donghuaSection.className = 'search-result-section';
                donghuaSection.innerHTML = `<h3>Donghua</h3>`;
                const donghuaGrid = document.createElement('div');
                donghuaGrid.className = 'anime-grid';
                donghuaSection.appendChild(donghuaGrid);
                container.appendChild(donghuaSection);
                renderAnimeList(donghuaItems, donghuaGrid, true); // Gunakan renderAnimeList untuk bagian ini
            }
        }

        // Fungsi untuk memuat halaman utama (Anime dan Donghua Terbaru)
        async function loadHomePage() {
            // Muat Anime Terbaru (dari ongoing_anime di /home)
            const animeData = await fetchAPI('/home');
            if (animeData && animeData.data && animeData.data.ongoing_anime) {
                renderAnimeList(animeData.data.ongoing_anime, 'anime-latest-grid', false);
            } else {
                renderAnimeList([], 'anime-latest-grid', false);
                console.warn("Struktur data /home (anime) tidak sesuai:", animeData);
            }

            // Muat Donghua Terbaru (kita gunakan series ongoing sebagai contoh)
            const donghuaData = await fetchAPI('/donghua/ongoing/1'); // Ganti endpoint
            if (donghuaData && donghuaData.data && Array.isArray(donghuaData.data.ongoing_donghua)) { // Periksa struktur
                renderAnimeList(donghuaData.data.ongoing_donghua, 'donghua-latest-grid', true); // Gunakan ongoing_donghua
            } else {
                renderAnimeList([], 'donghua-latest-grid', true);
                console.warn("Struktur data /donghua/ongoing (donghua) tidak sesuai:", donghuaData);
            }

            // Tampilkan section home
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('home-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman ongoing
        async function loadOngoingPage() {
            const page = 1; // Untuk sekarang, tetap gunakan halaman 1
            const data = await fetchAPI(`/ongoing-anime?page=${page}`);
            if (data && data.data && data.data.ongoingAnimeData) {
                // Gunakan data.ongoingAnimeData dari struktur JSON yang baru
                renderAnimeList(data.data.ongoingAnimeData, 'ongoing-anime-list', false); // Tambahkan parameter false
            } else {
                renderAnimeList([], 'ongoing-anime-list', false); // Tampilkan pesan jika tidak ada data
                console.warn("Struktur data /ongoing-anime tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('ongoing-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman completed
        async function loadCompletedPage() {
            const page = 1; // Untuk sekarang, tetap gunakan halaman 1
            const data = await fetchAPI(`/complete-anime/${page}`);
            if (data && data.data && data.data.completeAnimeData) {
                // Gunakan data.completeAnimeData dari struktur JSON yang baru
                renderAnimeList(data.data.completeAnimeData, 'completed-anime-list', false); // Tambahkan parameter false
            } else {
                renderAnimeList([], 'completed-anime-list', false); // Tampilkan pesan jika tidak ada data
                console.warn("Struktur data /complete-anime tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('completed-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman genre
        async function loadGenrePage() {
            const data = await fetchAPI('/genre');
            const container = document.getElementById('genre-list');
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (data && data.data && Array.isArray(data.data)) {
                data.data.forEach(genre => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = genre.name;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        showAnimeByGenre(genre.slug, genre.name);
                    });
                    container.appendChild(link);
                });
            } else {
                container.innerHTML = '<p>Daftar genre tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /genre tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('genre-content').classList.remove('hidden');
        }

        // Fungsi untuk menampilkan anime berdasarkan genre
        async function showAnimeByGenre(genreSlug, genreName) {
            const data = await fetchAPI(`/genre/${genreSlug}?page=1`); // Gunakan page 1 untuk contoh
            if (data && data.data && data.data.anime) { // Periksa data.anime
                renderAnimeList(data.data.anime, 'search-results-list', false); // Kirim array anime ke renderAnimeList
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Genre: ${genreName}`;
            } else {
                document.getElementById('search-results-list').innerHTML = '<p>Daftar anime untuk genre ini tidak ditemukan atau struktur API berubah.</p>';
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Genre: ${genreName}`;
                console.warn("Struktur data /genre/{slug} tidak sesuai:", data);
            }

            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('search-results').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman jadwal
        async function loadSchedulePage() {
            const data = await fetchAPI('/schedule');
            const container = document.getElementById('schedule-list');
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (data && data.data && Array.isArray(data.data)) {
                data.data.forEach(daySchedule => {
                    const daySection = document.createElement('div');
                    daySection.className = 'schedule-day';

                    daySection.innerHTML = `
                        <h3>${daySchedule.day}</h3>
                        <div class="anime-grid">
                            ${daySchedule.anime_list.map(anime => `
                                <div class="anime-card" onclick="showAnimeDetail('${anime.slug}')">
                                    <img src="${anime.poster || 'https://via.placeholder.com/180x250?text=No+Image'}" alt="${anime.anime_name}">
                                    <div class="info">
                                        <h3>${anime.anime_name}</h3>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(daySection);
                });
            } else {
                container.innerHTML = '<p>Jadwal rilis tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /schedule tidak sesuai:", data);
            }

            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('schedule-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman semua anime
        async function loadAllAnimePage() {
            const data = await fetchAPI('/unlimited');
            const container = document.getElementById('all-anime-list');
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (data && data.data && data.data.list && Array.isArray(data.data.list)) {
                data.data.list.forEach(letterGroup => {
                    const letterSection = document.createElement('div');
                    letterSection.className = 'all-anime-letter';

                    // Judul huruf
                    const letterTitle = document.createElement('h3');
                    letterTitle.textContent = letterGroup.startWith;
                    letterSection.appendChild(letterTitle);

                    // Daftar anime untuk huruf ini
                    const animeList = document.createElement('ul');
                    animeList.className = 'all-anime-list-ul';
                    letterGroup.animeList.forEach(anime => {
                        const listItem = document.createElement('li');
                        // Gunakan anime.animeId untuk navigasi ke detail
                        listItem.innerHTML = `<a href="#" onclick="showAnimeDetail('${anime.animeId}'); return false;">${anime.title}</a>`;
                        animeList.appendChild(listItem);
                    });
                    letterSection.appendChild(animeList);

                    container.appendChild(letterSection);
                });
            } else {
                container.innerHTML = '<p>Daftar semua anime tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /unlimited tidak sesuai:", data);
            }

            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('all-anime-content').classList.remove('hidden');
        }

        // Fungsi untuk merender link download batch ke HTML
        function renderBatchLinks(batchData, container) {
            if (!container || !batchData) {
                console.error('Container atau data batch tidak valid');
                return;
            }

            // Kosongkan kontainer sebelumnya
            container.innerHTML = '';

            // Judul Batch
            const titleElement = document.createElement('h4');
            titleElement.textContent = `Batch: ${batchData.title}`;
            container.appendChild(titleElement);

            // Loop melalui format (meskipun biasanya hanya satu)
            batchData.downloadUrl.formats.forEach(format => {
                const formatDiv = document.createElement('div');
                formatDiv.className = 'batch-format';

                const formatTitle = document.createElement('h5');
                formatTitle.textContent = format.title;
                formatDiv.appendChild(formatTitle);

                // Loop melalui kualitas dalam format ini
                format.qualities.forEach(quality => {
                    const qualityDiv = document.createElement('div');
                    qualityDiv.className = 'batch-quality';

                    const qualityTitle = document.createElement('p');
                    qualityTitle.textContent = `${quality.title} (${quality.size})`;
                    qualityDiv.appendChild(qualityTitle);

                    // Loop melalui link download untuk kualitas ini
                    const linkList = document.createElement('ul');
                    quality.urls.forEach(link => {
                        const linkItem = document.createElement('li');
                        // Gunakan link.title sebagai teks link
                        linkItem.innerHTML = `<a href="${link.url}" target="_blank">${link.title}</a>`;
                        linkList.appendChild(linkItem);
                    });
                    qualityDiv.appendChild(linkList);
                    formatDiv.appendChild(qualityDiv);
                });
                container.appendChild(formatDiv);
            });
        }

        // Fungsi Toggle Daftar Episode
        function toggleEpisodeList() {
            const episodeList = document.getElementById('episode-list');
            const button = document.getElementById('toggle-episode-list');

            if (episodeList.classList.contains('hidden')) {
                episodeList.classList.remove('hidden');
                button.textContent = 'Sembunyikan';
            } else {
                episodeList.classList.add('hidden');
                button.textContent = 'Tampilkan';
            }
        }

        // Event Listeners
        document.getElementById('search-button').addEventListener('click', () => {
            searchContent(); // Panggil tanpa parameter
        });

        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchContent(); // Panggil tanpa parameter
            }
        });

        // Toggle Episode List
        document.getElementById('toggle-episode-list').addEventListener('click', toggleEpisodeList);

        // Navigasi Halaman Sederhana
        document.querySelectorAll('nav ul li a[data-page]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.target.getAttribute('data-page');
                switch(page) {
                    case 'home':
                        loadHomePage();
                        break;
                    case 'ongoing':
                        loadOngoingPage();
                        break;
                    case 'completed':
                        loadCompletedPage();
                        break;
                    case 'schedule':
                        loadSchedulePage();
                        break;
                    case 'genre':
                        loadGenrePage();
                        break;
                    case 'all-anime':
                        loadAllAnimePage();
                        break;
                    // case 'donghua-home': // Dihapus
                    // case 'donghua-ongoing': // Dihapus
                    // case 'donghua-completed': // Dihapus
                    // case 'donghua-genre': // Dihapus
                    // case 'donghua-season-2025': // Dihapus
                    // case 'donghua-season-2024': // Dihapus
                    // case 'donghua-season-2023': // Dihapus
                    // Tambahkan case lain jika diperlukan
                }
                // Update kelas active
                document.querySelectorAll('nav ul li a').forEach(a => a.classList.remove('active'));
                e.target.classList.add('active');
            });
        });

        // Muat halaman home saat pertama kali
        document.addEventListener('DOMContentLoaded', () => {
            loadHomePage();
        });
    </script>
</body>
</html>
