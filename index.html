<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lionime - Nonton Anime Sub Indo Gratis</title>
    <style>
        /* Gaya Umum */
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #2c3e50;
            --background-color: #1a1a1a;
            --card-background: #2d2d2d;
            --text-color: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        a {
            text-decoration: none;
            color: var(--text-color);
        }

        a:hover {
            color: var(--primary-color);
        }

        .hidden {
            display: none;
        }

        /* Header */
        header {
            background-color: var(--secondary-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--box-shadow);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav ul li a {
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav ul li a.active {
            color: var(--primary-color);
        }

        .search-container {
            display: flex;
            gap: 0.5rem;
        }

        #search-input, #search-button {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            border: none;
        }

        #search-input {
            background-color: #3c3c3c;
            color: var(--text-color);
            width: 200px;
        }

        #search-button {
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #search-button:hover {
            background-color: #c0392b;
        }

        /* Main Content */
        main {
            padding: 2rem 0;
        }

        section {
            margin-bottom: 2rem;
        }

        h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        /* Anime Grid */
        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .anime-card {
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .anime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .anime-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }

        .anime-card .info {
            padding: 1rem;
        }

        .anime-card .info h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .anime-card .info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Detail Content */
        #detail-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        #anime-detail {
            display: flex;
            gap: 2rem;
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #anime-detail img {
            width: 250px;
            height: 350px;
            object-fit: cover;
            border-radius: var(--border-radius);
        }

        #anime-detail .text {
            flex: 1;
        }

        #anime-detail .text h1 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        #anime-detail .text p {
            margin-bottom: 0.5rem;
        }

        #recommendations-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #3c3c3c;
        }

        #recommendations-section h3 {
            margin-bottom: 1rem;
        }

        #episode-list ul {
            list-style: none;
            padding: 1.5rem;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #episode-list ul li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #3c3c3c;
        }

        #episode-list ul li:last-child {
            border-bottom: none;
        }

        #episode-list ul li a {
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        #episode-list ul li a:hover {
            color: var(--primary-color);
        }

        /* Episode Content */
        #episode-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        #video-player-container {
            background-color: black;
            height: 500px;
            border-radius: var(--border-radius);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
        }

        #video-player-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        #episode-info {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #episode-info h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        /* Genre List */
        #genre-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        #genre-list a {
            display: block;
            padding: 1rem;
            background-color: var(--card-background);
            border-radius: var(--border-radius);
            text-align: center;
            transition: background-color 0.3s ease;
        }

        #genre-list a:hover {
            background-color: #3c3c3c;
        }

        /* Schedule */
        .schedule-day {
            margin-bottom: 2rem;
        }

        .schedule-day h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        /* All Anime */
        .all-anime-letter {
            margin-bottom: 2rem;
        }

        .all-anime-letter h3 {
            color: var(--primary-color);
            display: inline-block;
            width: 2rem;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .all-anime-list-ul {
            list-style: none;
            padding-left: 3rem;
        }

        .all-anime-list-ul li {
            margin-bottom: 0.25rem;
        }

        .all-anime-list-ul li a {
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .all-anime-list-ul li a:hover {
            color: var(--primary-color);
        }

        /* Batch Links */
        #batch-links-container {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #3c3c3c;
        }

        #batch-links-container h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .batch-format {
            margin-bottom: 1rem;
        }

        .batch-quality {
            margin-bottom: 0.5rem;
        }

        .batch-quality p {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .batch-quality ul {
            list-style: none;
            padding-left: 1rem;
        }

        .batch-quality ul li {
            margin-bottom: 0.25rem;
        }

        .batch-quality ul li a {
            color: var(--text-secondary);
            text-decoration: underline;
            transition: color 0.3s ease;
        }

        .batch-quality ul li a:hover {
            color: var(--primary-color);
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            padding: 1.5rem 0;
            text-align: center;
            margin-top: auto;
        }

        /* Media Queries untuk Responsif */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            #search-input {
                width: 100%;
            }

            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            #anime-detail {
                flex-direction: column;
            }

            #anime-detail img {
                width: 100%;
                height: 300px;
            }

            #video-player-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1 class="logo">Lionime</h1>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-page="home">Home</a></li>
                    <li><a href="#" data-page="ongoing">Ongoing</a></li>
                    <li><a href="#" data-page="completed">Completed</a></li>
                    <li><a href="#" data-page="schedule">Schedule</a></li>
                    <li><a href="#" data-page="genre">Genre</a></li>
                    <li><a href="#" data-page="all-anime">All Anime</a>
                </ul>
            </nav>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Cari anime...">
                <button id="search-button">Cari</button>
            </div>
        </div>
    </header>

    <main class="container">
        <section id="home-content">
            <h2>Anime Terbaru</h2>
            <div id="home-anime-list" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>
        </section>

        <section id="detail-content" class="hidden">
            <div id="anime-detail">
                <!-- Detail anime akan dimuat di sini -->
            </div>
            <div id="episode-list">
                <!-- Daftar episode akan dimuat di sini -->
            </div>
        </section>

        <section id="episode-content" class="hidden">
            <div id="video-player-container">
                <!-- Player video akan dimuat di sini -->
            </div>
            <div id="episode-info">
                <!-- Info episode akan dimuat di sini -->
            </div>
        </section>

        <section id="search-results" class="hidden">
            <h2>Hasil Pencarian</h2>
            <div id="search-results-list" class="anime-grid">
                <!-- Hasil pencarian akan dimuat di sini -->
            </div>
        </section>

        <section id="ongoing-content" class="hidden">
            <h2>Anime Sedang Tayang</h2>
            <div id="ongoing-anime-list" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>
        </section>

        <section id="completed-content" class="hidden">
            <h2>Anime Tamat</h2>
            <div id="completed-anime-list" class="anime-grid">
                <!-- Konten dari API akan dimuat di sini -->
            </div>
        </section>

        <section id="genre-content" class="hidden">
            <h2>Daftar Genre</h2>
            <div id="genre-list">
                <!-- Genre akan dimuat di sini -->
            </div>
        </section>

        <section id="schedule-content" class="hidden">
            <h2>Jadwal Rilis Anime</h2>
            <div id="schedule-list">
                <!-- Jadwal akan dimuat di sini -->
            </div>
        </section>

        <section id="all-anime-content" class="hidden">
            <h2>Semua Anime</h2>
            <div id="all-anime-list">
                <!-- Daftar semua anime akan dimuat di sini -->
            </div>
        </section>

    </main>

    <footer>
        <p>&copy; 2025 Lionime. Semua hak dilindungi.</p>
    </footer>

    <script>
        const API_BASE = 'https://www.sankavollerei.com/anime';

        // Fungsi untuk memanggil API
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data from API:', error);
                return null;
            }
        }

        // Fungsi untuk merender daftar anime ke HTML
        function renderAnimeList(animes, containerId) {
            const container = document.getElementById(containerId);
            if (!container || !animes) {
                console.error('Container atau data animes tidak valid');
                return;
            }
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (!animes.length) {
                container.innerHTML = '<p>Tidak ada data yang ditemukan.</p>';
                return;
            }

            animes.forEach(anime => {
                const card = document.createElement('div');
                card.className = 'anime-card';
                // Gunakan properti yang tersedia tergantung datanya (ongoing, complete, search, detail recs)
                let infoText = 'Info Tidak Diketahui';
                if (anime.current_episode) {
                    infoText = anime.current_episode; // Misal: "Total 7 Eps"
                } else if (anime.episode_count) {
                    infoText = `Eps: ${anime.episode_count}`;
                } else if (anime.status) {
                    infoText = anime.status; // Misal: "Completed"
                }
                // Tambahkan release_day jika tersedia dan tidak ada current_episode
                if (anime.release_day && !anime.current_episode) {
                    infoText += ` (${anime.release_day})`;
                } else if (anime.release_day && anime.current_episode) {
                     infoText = `${anime.current_episode} (${anime.release_day})`;
                } else if (anime.last_release_date) {
                     infoText += ` (${anime.last_release_date})`;
                }

                card.innerHTML = `
                    <img src="${anime.poster || 'https://via.placeholder.com/180x250?text=No+Image'}" alt="${anime.title}">
                    <div class="info">
                        <h3>${anime.title}</h3>
                        <p>${infoText}</p>
                    </div>
                `;
                card.addEventListener('click', () => showAnimeDetail(anime.slug));
                container.appendChild(card);
            });
        }

        // Fungsi untuk menampilkan detail anime
        async function showAnimeDetail(slug) {
            const data = await fetchAPI(`/anime/${slug}`);
            if (!data || !data.data) {
                console.error("Data detail anime tidak ditemukan atau struktur salah:", data);
                document.getElementById('anime-detail').innerHTML = '<p>Detail anime tidak ditemukan.</p>';
                document.getElementById('episode-list').innerHTML = '';
                return;
            }

            const anime = data.data; // Ambil objek anime dari data.data
            const detailContainer = document.getElementById('anime-detail');
            const episodeListContainer = document.getElementById('episode-list');

            // Render detail utama anime
            detailContainer.innerHTML = `
                <img src="${anime.poster || 'https://via.placeholder.com/250x350?text=No+Image'}" alt="${anime.title}">
                <div class="text">
                    <h1>${anime.title}</h1>
                    <p><strong>Judul Jepang:</strong> ${anime.japanese_title || 'Tidak Diketahui'}</p>
                    <p><strong>Genre:</strong> ${anime.genres ? anime.genres.map(g => g.name).join(', ') : 'Tidak Diketahui'}</p>
                    <p><strong>Status:</strong> ${anime.status || 'Tidak Diketahui'}</p>
                    <p><strong>Episode:</strong> ${anime.episode_count || 'Tidak Diketahui'}</p>
                    <p><strong>Tipe:</strong> ${anime.type || 'Tidak Diketahui'}</p>
                    <p><strong>Studio:</strong> ${anime.studio || 'Tidak Diketahui'}</p>
                    <p><strong>Rating:</strong> ${anime.rating || 'Tidak Diketahui'}</p>
                    <p><strong>Rilis:</strong> ${anime.release_date || 'Tidak Diketahui'}</p>
                    <p><strong>Durasi:</strong> ${anime.duration || 'Tidak Diketahui'}</p>
                    <p><strong>Sinopsis:</strong> ${anime.synopsis || 'Tidak tersedia.'}</p>
                    <!-- Link batch akan ditambahkan di sini -->
                    <div id="batch-links-container">
                        <!-- Link batch akan dimuat di sini -->
                    </div>
                </div>
            `;

            // --- Tambahkan Link Batch ---
            if (anime.batch && anime.batch.slug) {
                const batchData = await fetchAPI(`/batch/${anime.batch.slug}`);
                if (batchData && batchData.data && batchData.data.downloadUrl) {
                    const batchContainer = document.getElementById('batch-links-container');
                    renderBatchLinks(batchData.data, batchContainer);
                } else {
                    console.warn("Data batch tidak ditemukan atau struktur salah:", batchData);
                    // Jika API batch gagal, tetap tampilkan link lama (otakudesu_url dari batch)
                    document.getElementById('batch-links-container').innerHTML = `<p><a href="${anime.batch.otakudesu_url}" target="_blank">Link Batch (Luaran): ${anime.batch.slug}</a></p>`;
                }
            } else {
                // Jika tidak ada informasi batch di detail, sembunyikan container atau biarkan kosong
                document.getElementById('batch-links-container').style.display = 'none';
            }

            // Tambahkan container untuk rekomendasi
            detailContainer.innerHTML += `
                <div id="recommendations-section" class="recommendations-container">
                    <h3>Anime Rekomendasi</h3>
                    <div id="recommendations-list" class="anime-grid">
                        <!-- Rekomendasi akan dimuat di sini -->
                    </div>
                </div>
            `;

            // Render rekomendasi jika ada
            if (anime.recommendations && anime.recommendations.length > 0) {
                renderAnimeList(anime.recommendations, 'recommendations-list');
            } else {
                document.getElementById('recommendations-list').innerHTML = '<p>Tidak ada rekomendasi.</p>';
            }

            // Render daftar episode
            if (anime.episode_lists && anime.episode_lists.length > 0) {
                episodeListContainer.innerHTML = '<h3>Daftar Episode</h3><ul></ul>';
                const list = episodeListContainer.querySelector('ul');
                // Urutkan episode berdasarkan episode_number (opsional, tapi bagus untuk urutan)
                const sortedEpisodes = [...anime.episode_lists].sort((a, b) => a.episode_number - b.episode_number);

                sortedEpisodes.forEach(ep => {
                    const li = document.createElement('li');
                    // Gunakan episode_number untuk teks link
                    li.innerHTML = `<a href="#" onclick="showEpisode('${ep.slug}'); return false;">${ep.episode_number}. ${ep.episode}</a>`;
                    list.appendChild(li);
                });
            } else {
                episodeListContainer.innerHTML = '<h3>Daftar Episode</h3><p>Daftar episode tidak tersedia.</p>';
            }

            // Tampilkan section detail
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('detail-content').classList.remove('hidden');
        }

        // Fungsi untuk menampilkan episode
        async function showEpisode(slug) {
            const data = await fetchAPI(`/episode/${slug}`);
            if (!data || !data.data) {
                console.error("Data episode tidak ditemukan atau struktur salah:", data);
                document.getElementById('video-player-container').innerHTML = '<p>Link streaming tidak ditemukan.</p>';
                document.getElementById('episode-info').innerHTML = '<h1>Episode Tidak Diketahui</h1>';
                return;
            }

            const episodeData = data.data;
            const playerContainer = document.getElementById('video-player-container');
            const infoContainer = document.getElementById('episode-info');

            // --- Info Episode ---
            infoContainer.innerHTML = `<h1>${episodeData.episode || 'Judul Episode Tidak Diketahui'}</h1>`;

            // --- Player Video ---
            // Cek apakah stream_url tersedia
            if (episodeData.stream_url) {
                playerContainer.innerHTML = `<iframe src="${episodeData.stream_url}" frameborder="0" allowfullscreen></iframe>`;
            } else {
                // Jika stream_url tidak ada, dan kita tidak bisa mengandalkan /server/ karena error,
                // maka kita beri tahu pengguna bahwa tidak bisa dimainkan secara langsung di sini.
                playerContainer.innerHTML = '<p>Link streaming utama tidak ditemukan atau tidak bisa dimuat di sini.</p>';
            }

            // Tampilkan section episode
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('episode-content').classList.remove('hidden');
        }

        // Fungsi untuk pencarian
        async function searchAnime() {
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;

            const data = await fetchAPI(`/search/${encodeURIComponent(query)}`);
            if (data && data.data && Array.isArray(data.data)) { // Periksa data.data sebagai array
                renderAnimeList(data.data, 'search-results-list'); // Kirim array hasil pencarian ke renderAnimeList
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Pencarian: ${query}`;
            } else {
                document.getElementById('search-results-list').innerHTML = '<p>Hasil pencarian tidak ditemukan atau struktur API berubah.</p>';
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Pencarian: ${query}`;
                console.warn("Struktur data /search/{query} tidak sesuai:", data);
            }

            // Tampilkan section hasil pencarian
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('search-results').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman utama
        async function loadHomePage() {
            const data = await fetchAPI('/home');
            if (data && data.data && data.data.ongoing_anime) {
                // Gunakan data.ongoing_anime dari struktur JSON yang baru
                renderAnimeList(data.data.ongoing_anime, 'home-anime-list');
            } else {
                // Tampilkan pesan jika data tidak ditemukan atau struktur tidak sesuai
                document.getElementById('home-anime-list').innerHTML = '<p>Data tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /home tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('home-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman ongoing
        async function loadOngoingPage() {
            const page = 1; // Untuk sekarang, tetap gunakan halaman 1
            const data = await fetchAPI(`/ongoing-anime?page=${page}`);
            if (data && data.data && data.data.ongoingAnimeData) {
                // Gunakan data.ongoingAnimeData dari struktur JSON yang baru
                renderAnimeList(data.data.ongoingAnimeData, 'ongoing-anime-list');
            } else {
                renderAnimeList([], 'ongoing-anime-list'); // Tampilkan pesan jika tidak ada data
                console.warn("Struktur data /ongoing-anime tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('ongoing-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman completed
        async function loadCompletedPage() {
            const page = 1; // Untuk sekarang, tetap gunakan halaman 1
            const data = await fetchAPI(`/complete-anime/${page}`);
            if (data && data.data && data.data.completeAnimeData) {
                // Gunakan data.completeAnimeData dari struktur JSON yang baru
                renderAnimeList(data.data.completeAnimeData, 'completed-anime-list');
            } else {
                renderAnimeList([], 'completed-anime-list'); // Tampilkan pesan jika tidak ada data
                console.warn("Struktur data /complete-anime tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('completed-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman genre
        async function loadGenrePage() {
            const data = await fetchAPI('/genre');
            const container = document.getElementById('genre-list');
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (data && data.data && Array.isArray(data.data)) {
                data.data.forEach(genre => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = genre.name;
                    // Untuk sementara, hanya tampilkan alert atau konsol log
                    // Untuk implementasi penuh, kita perlu menangani klik genre
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Panggil fungsi baru untuk menampilkan anime berdasarkan genre
                        showAnimeByGenre(genre.slug, genre.name);
                    });
                    container.appendChild(link);
                });
            } else {
                container.innerHTML = '<p>Daftar genre tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /genre tidak sesuai:", data);
            }
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('genre-content').classList.remove('hidden');
        }

        // Fungsi untuk menampilkan anime berdasarkan genre
        async function showAnimeByGenre(genreSlug, genreName) {
            const data = await fetchAPI(`/genre/${genreSlug}?page=1`); // Gunakan page 1 untuk contoh
            if (data && data.data && data.data.anime) { // Periksa data.anime
                renderAnimeList(data.data.anime, 'search-results-list'); // Kirim array anime ke renderAnimeList
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Genre: ${genreName}`;
            } else {
                document.getElementById('search-results-list').innerHTML = '<p>Daftar anime untuk genre ini tidak ditemukan atau struktur API berubah.</p>';
                document.getElementById('search-results').querySelector('h2').textContent = `Hasil Genre: ${genreName}`;
                console.warn("Struktur data /genre/{slug} tidak sesuai:", data);
            }

            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('search-results').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman jadwal
        async function loadSchedulePage() {
            const data = await fetchAPI('/schedule');
            const container = document.getElementById('schedule-list');
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (data && data.data && Array.isArray(data.data)) {
                data.data.forEach(daySchedule => {
                    const daySection = document.createElement('div');
                    daySection.className = 'schedule-day';

                    daySection.innerHTML = `
                        <h3>${daySchedule.day}</h3>
                        <div class="anime-grid">
                            ${daySchedule.anime_list.map(anime => `
                                <div class="anime-card" onclick="showAnimeDetail('${anime.slug}')">
                                    <img src="${anime.poster || 'https://via.placeholder.com/180x250?text=No+Image'}" alt="${anime.anime_name}">
                                    <div class="info">
                                        <h3>${anime.anime_name}</h3>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(daySection);
                });
            } else {
                container.innerHTML = '<p>Jadwal rilis tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /schedule tidak sesuai:", data);
            }

            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('schedule-content').classList.remove('hidden');
        }

        // Fungsi untuk memuat halaman semua anime
        async function loadAllAnimePage() {
            const data = await fetchAPI('/unlimited');
            const container = document.getElementById('all-anime-list');
            container.innerHTML = ''; // Kosongkan kontainer sebelumnya

            if (data && data.data && data.data.list && Array.isArray(data.data.list)) {
                data.data.list.forEach(letterGroup => {
                    const letterSection = document.createElement('div');
                    letterSection.className = 'all-anime-letter';

                    // Judul huruf
                    const letterTitle = document.createElement('h3');
                    letterTitle.textContent = letterGroup.startWith;
                    letterSection.appendChild(letterTitle);

                    // Daftar anime untuk huruf ini
                    const animeList = document.createElement('ul');
                    animeList.className = 'all-anime-list-ul';
                    letterGroup.animeList.forEach(anime => {
                        const listItem = document.createElement('li');
                        // Gunakan anime.animeId untuk navigasi ke detail
                        listItem.innerHTML = `<a href="#" onclick="showAnimeDetail('${anime.animeId}'); return false;">${anime.title}</a>`;
                        animeList.appendChild(listItem);
                    });
                    letterSection.appendChild(animeList);

                    container.appendChild(letterSection);
                });
            } else {
                container.innerHTML = '<p>Daftar semua anime tidak ditemukan atau struktur API berubah.</p>';
                console.warn("Struktur data /unlimited tidak sesuai:", data);
            }

            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('all-anime-content').classList.remove('hidden');
        }

        // Fungsi untuk merender link download batch ke HTML
        function renderBatchLinks(batchData, container) {
            if (!container || !batchData) {
                console.error('Container atau data batch tidak valid');
                return;
            }

            // Kosongkan kontainer sebelumnya
            container.innerHTML = '';

            // Judul Batch
            const titleElement = document.createElement('h4');
            titleElement.textContent = `Batch: ${batchData.title}`;
            container.appendChild(titleElement);

            // Loop melalui format (meskipun biasanya hanya satu)
            batchData.downloadUrl.formats.forEach(format => {
                const formatDiv = document.createElement('div');
                formatDiv.className = 'batch-format';

                const formatTitle = document.createElement('h5');
                formatTitle.textContent = format.title;
                formatDiv.appendChild(formatTitle);

                // Loop melalui kualitas dalam format ini
                format.qualities.forEach(quality => {
                    const qualityDiv = document.createElement('div');
                    qualityDiv.className = 'batch-quality';

                    const qualityTitle = document.createElement('p');
                    qualityTitle.textContent = `${quality.title} (${quality.size})`;
                    qualityDiv.appendChild(qualityTitle);

                    // Loop melalui link download untuk kualitas ini
                    const linkList = document.createElement('ul');
                    quality.urls.forEach(link => {
                        const linkItem = document.createElement('li');
                        // Gunakan link.title sebagai teks link
                        linkItem.innerHTML = `<a href="${link.url}" target="_blank">${link.title}</a>`;
                        linkList.appendChild(linkItem);
                    });
                    qualityDiv.appendChild(linkList);
                    formatDiv.appendChild(qualityDiv);
                });
                container.appendChild(formatDiv);
            });
        }

        // Event Listeners
        document.getElementById('search-button').addEventListener('click', searchAnime);
        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchAnime();
        });

        // Navigasi Halaman Sederhana
        document.querySelectorAll('nav ul li a[data-page]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.target.getAttribute('data-page');
                switch(page) {
                    case 'home':
                        loadHomePage();
                        break;
                    case 'ongoing':
                        loadOngoingPage();
                        break;
                    case 'completed':
                        loadCompletedPage();
                        break;
                    case 'schedule':
                        loadSchedulePage();
                        break;
                    case 'genre':
                        loadGenrePage();
                        break;
                    case 'all-anime':
                        loadAllAnimePage();
                        break;
                    // Tambahkan case lain jika diperlukan
                }
                // Update kelas active
                document.querySelectorAll('nav ul li a').forEach(a => a.classList.remove('active'));
                e.target.classList.add('active');
            });
        });

        // Muat halaman home saat pertama kali
        document.addEventListener('DOMContentLoaded', () => {
            loadHomePage();
            // Tambahkan event listener untuk tombol kembali jika perlu
            window.addEventListener('popstate', () => {
                // Implementasi navigasi browser jika diinginkan
            });
        });
    </script>
</body>
</html>